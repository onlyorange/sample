(function(){var h=/^\?(.*)/;var e=/:([\w\d]+)/g;var g=/\*([\w\d]+)/g;var b=/[-[\]{}()+?.,\\^$|#\s]/g;var a=/(\?.*)$/;var d=/^([^\?]*)/;Backbone.Router.arrayValueSplit="|";var c=Backbone.History.prototype.getFragment;_.extend(Backbone.History.prototype,{getFragment:function(j,i,k){j=c.apply(this,arguments);if(k){j=j.replace(a,"")}return j},getQueryParameters:function(k,i){k=c.apply(this,arguments);var m=k.replace(d,"");var j=m.match(h);if(j){m=j[1];var l={};f(m,function(n,o){if(!l[n]){l[n]=o}else{if(_.isString(l[n])){l[n]=[l[n],o]}else{l[n].push(o)}}});return l}else{return{}}}});_.extend(Backbone.Router.prototype,{initialize:function(i){this.encodedSplatParts=i&&i.encodedSplatParts},getFragment:function(j,i,k){j=c.apply(this,arguments);if(k){j=j.replace(a,"")}return j},_routeToRegExp:function(j){var k=(g.exec(j)||{index:-1});var i=(e.exec(j)||{index:-1});j=j.replace(b,"\\$&").replace(e,"([^/?]*)").replace(g,"([^?]*)");j+="([?]{1}.*)?";var l=new RegExp("^"+j+"$");if(k.index>=0){if(i>=0){l.splatMatch=k.index-i.index}else{l.splatMatch=-1}}return l},_extractParameters:function(q,p){var l=q.exec(p).slice(1);var o=l.length&&l[l.length-1]&&l[l.length-1].match(h);if(o){var j=o[1];var n={};if(j){var r=this;f(j,function(i,s){r._setParamValue(i,s,n)})}l[l.length-1]=n}var k=l.length;if(q.splatMatch&&this.encodedSplatParts){if(q.splatMatch<0){return l}else{k=k-1}}for(var m=0;m<k;m++){if(_.isString(l[m])){l[m]=decodeURIComponent(l[m])}}return l},_setParamValue:function(l,o,n){var p=l.split(".");var m=n;for(var k=0;k<p.length;k++){var j=p[k];if(k===p.length-1){m[j]=this._decodeParamValue(o,m[j])}else{m=m[j]=m[j]||{}}}},_decodeParamValue:function(m,l){var n=Backbone.Router.arrayValueSplit;if(m.indexOf(n)>=0){var j=m.split(n);for(var k=j.length-1;k>=0;k--){if(!j[k]){j.splice(k,1)}else{j[k]=decodeURIComponent(j[k])}}return j}if(!l){return decodeURIComponent(m)}else{if(_.isArray(l)){l.push(m);return l}else{return[l,m]}}},toFragment:function(j,i){if(i){if(!_.isString(i)){i=this._toQueryString(i)}j+="?"+i}return j},_toQueryString:function(l,j){var s=Backbone.Router.arrayValueSplit;function n(i){return i.replace(s,encodeURIComponent(s))}if(!l){return""}j=j||"";var q="";for(var k in l){var p=l[k];if(_.isString(p)||_.isNumber(p)||_.isBoolean(p)||_.isDate(p)){p=this._toQueryParam(p);if(_.isBoolean(p)||p){q+=(q?"&":"")+this._toQueryParamName(k,j)+"="+n(encodeURIComponent(p))}}else{if(_.isArray(p)){var r="";for(var o in p){var m=this._toQueryParam(p[o]);if(_.isBoolean(m)||m){r+=s+n(m)}}if(r){q+=(q?"&":"")+this._toQueryParamName(k,j)+"="+r}}else{var t=this._toQueryString(p,this._toQueryParamName(k,j,true));if(t){q+=(q?"&":"")+t}}}}return q},_toQueryParamName:function(i,k,j){return(k+i+(j?".":""))},_toQueryParam:function(i){if(_.isNull(i)||_.isUndefined(i)){return null}if(_.isDate(i)){return i.getDate().getTime()}return i}});function f(k,j){var i=k.split("&");_.each(i,function(m){var l=m.split("=");if(l.length>1&&l[1]){j(l[0],l[1])}})}})();